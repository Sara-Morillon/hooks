# Hooks

Some utility hooks.

# Table of contents

- [useTheme](#usetheme)
- [useFetch](#usefetch)
- [usePagination](#usepagination)
- [useForm](#useform)
- [useCopy](#usecopy)
- [Contribute](#contribute)

# useTheme

`useTheme` returns 'dark' or 'light' according to prefers-color-scheme media query.

It also changes document root color-scheme accordingly.

## Example

```typescript
import { useTheme } from '@saramorillon/hooks'

function MyComponent() {
  const theme = useTheme()
  return theme === 'dark' ? <Dark /> : <Light />
}
```

## API

```typescript
useTheme(): Theme
```

### Arguments

None

### Returns

`Theme` - The theme ("light" or "dark").

# useFetch

`useFetch` provides an easy way to make any action that triggers a loading, returns some data and may generate an error (typical API call use case).

It also provides a refresh function to replay the action.

## Example

```typescript
import { useFetch } from '@saramorillon/hooks'
import { getData } from './service'

function MyComponent() {
  const [data, status, refresh] = useFetch(getData, null)

  if (status.loading) return <Spinner />
  if (status.error) return <Error />
  return (
    <>
      <Button onClick={refresh} />
      <Table data={data} />
    </>
  )
}
```

## API

```typescript
useFetch<T>(fetchFn: () => Promise<T>, defaultValue?: T): [T, IFetchedStatus, () => void]
```

### Arguments

`fetchFn: () => Promise<T>` - The action to run. **/!\ Must be memoized to avoid potential infinite loops.**

`defaultValue: T` - The default value to return.

### Returns

An array containing:

- `T` - the value returned by the action
- `IFetchedStatus` - an object containing
  - `loading: boolean` - indicates weither the action is currently pending or not
  - `error: unknown` - the error potentially generated by the action
- `() => void` - a refresh function

# usePagination

`usePagination` provides an easy way to generate a full pagination system.

## Example

```typescript
import { usePagination } from '@saramorillon/hooks'
import { getData } from './service'

const limit = 10

function MyComponent() {
  const { page, maxPages, setMaxPages, first, previous, next, last, canPrevious, canNext } = usePagination()
  const fetch = useCallback(() => getData(page, limit), [page])
  const [{ data, total }] = useFetch(fetch, { data: [], total: 0 })

  useEffect(() => {
    setMaxPages(Math.ceil(total / limit))
  }, [setMaxPages, total])
}

return (
  <div>
    <button disabled={!canPrevious} onClick={first}>
      First page
    </button>
    <button disabled={!canPrevious} onClick={previous}>
      Previous page
    </button>
    <span>
      Page {page} of {maxPages}
    </span>
    <button disabled={!canNext} onClick={next}>
      Next page
    </button>
    <button disabled={!canNext} onClick={last}>
      Last page
    </button>
  </div>
)
```

## API

```typescript
usePagination(initialValue = 1): IPagination
```

### Arguments

`initialValue?: number` - The initial page (default 1).

### Returns

An object containing:

- `page: number` - the current page
- `maxPage: number` - the max page
- `setMaxPage: React.Dispatch<React.SetStateAction<number>>` - a function to change the max page
- `goTo: React.Dispatch<React.SetStateAction<number>>` - a function to go to a specific page
- `first: () => void` - a function to go to the first page
- `previous: () => void` - a function to go to the previous page
- `next: () => void` - a function to go to the next page
- `last: () => void` - a function to go to the last page
- `canPrevious: boolean` - indicates weither the navigation to the previous page is possible
- `canNext: boolean` - indicates weither the navigation to the next page is possible

# useForm

`useForm` provides helpers to handle forms.

## Example

```typescript
import { useForm } from '@saramorillon/hooks'

type Data {
  name: string
}

function MyComponent({ data }: { data: Data }) {
  const onSave = useCallback((values: Partial<Data>) => {
    console.log(values)
  }, [])
  const { values, onSubmit, onChange, reset } = useForm(onSave, data)

  return (
    <form onSubmit={onSubmit} onReset={onReset}>
      <input value={name} onChange={(e) => onChange('name', e.target.value)} />
      <button type='submit'>Submit</button>
      <button type='reset'>Reset</button>
    </form>
  )
}
```

## API

```typescript
useForm<T>(props: IFormProps<T>): IForm<T>
```

### Arguments

`onSave: (values: T) => void` - The save action. **/!\ Must be memoized to avoid potential infinite loops.**

`initialValues: T` - The initial values.

### Returns

An object containing:

- `values: T` - the form values
- `onSubmit: (e: FormEvent) => void` - a function for submitting a form
- `onChange: <K extends keyof T>(name: K, value: T[K]) => void` - a function to change the values of the form
- `reset: () => void` - a function to reset the form to its initial values

# useCopy

`useCopy` provides helpers to handle clipboard copy.

## Example

```typescript
import { useCopy } from '@saramorillon/hooks'

function MyComponent() {
  const [authorized, status, copy] = useCopy()

  if (status.loading) return <Spinner />
  if (status.error) return <Error />

  return (
    <button onClick={() => copy('Something')} disabled={!authorized}>
      Copy
    </button>
  )
}
```

## API

```typescript
useCopy(): [boolean, ICopyStatus, () => void]
```

### Arguments

None

### Returns

An array containing:

- `authorized: boolean` - indicates weither the user authorized clipboard actions on their brower
- `ICopyStatus` - an object containing
  - `loading: boolean` - indicates weither the copy is currently pending or not
  - `error: unknown` - the error potentially generated by the copy
- `(data: string) => void` - the copy function

# Contribute

Any PR is welcomed! Please be sure to meet following requirements when posting a PR:

- Unit tests pass and code coverage is over 90%
- Code conventions have been respected (`yarn lint` can help)
- Code is properly formatted (`yarn format` can help)
